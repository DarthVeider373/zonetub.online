<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deepfinds - Scanning</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            "deeplinks-primary": "#e53e3e",
            "deeplinks-secondary": "#ffd700",
            "deeplinks-text": "#2d3748",
            "deeplinks-muted": "#a0aec0",
            "deeplinks-bg": "#f7fafc",
            "deeplinks-card": "#ffffff",
          },
        },
      },
    };
  </script>
  <style>
    @keyframes typewriter {
      from {
        width: 0;
      }

      to {
        width: 100%;
      }
    }

    .technical-log {
      overflow: hidden;
      white-space: nowrap;
      animation: typewriter 2s steps(40, end);
    }
  </style>
</head>

<body class="min-h-screen bg-gray-50">
  <!-- Warning Banner -->
  <div class="bg-red-600 text-white py-3 sm:py-4 px-2 sm:px-4 text-center">
    <div class="flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2">
      <span class="text-yellow-300 text-lg sm:text-xl">‚ö†Ô∏è</span>
      <span class="font-bold text-sm sm:text-base md:text-lg">
        You have used your last free trial. Stay on this page...
      </span>
    </div>
    <!-- Temporizador -->
    <div class="mt-2 text-sm sm:text-base font-semibold">
      <span id="timer-text">Time remaining: </span>
      <span id="timer" class="text-yellow-300 font-mono">--:--</span>
    </div>
  </div>

  <div class="max-w-6xl mx-auto px-2 sm:px-4 py-4 sm:py-8">
    <!-- Video Player -->
    <div class="mb-4 sm:mb-8">
      <div class="relative bg-black rounded-lg sm:rounded-2xl overflow-hidden shadow-2xl">
        <vturb-smartplayer id="vid-68f1a4bc9b6f16e5643c85b5" style="display: block; margin: 0 auto; width: 100%"></vturb-smartplayer>
        <vturb-smartplayer id="ab-69705dc110d72bdc9f39b649" style="display: block; margin: 0 auto; width: 100%; "></vturb-smartplayer>
        <script type="text/javascript"> var s = document.createElement("script"); s.src = "https://scripts.converteai.net/155f8fd6-7b7f-4008-8b29-65593dca7f17/ab-test/69705dc110d72bdc9f39b649/player.js", s.async = !0, document.head.appendChild(s); </script>
      </div>
    </div>

    <!-- CTA Button -->
    <div class="text-center my-8 hidden cta-button-section">
      <button onclick="viewCompleteScan()" class="bg-red-600 text-white py-4 px-8 rounded-2xl font-bold text-xl shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-105 cursor-pointer view-complete-scan-btn">
        VIEW COMPLETE SCAN
      </button>
    </div>

    <!-- EXPLICIT CONTENT DETECTED Card -->
    <div id="explicit-content-card" class="bg-white rounded-lg sm:rounded-2xl p-4 sm:p-6 md:p-8 mb-4 sm:mb-8 border-2 border-red-500">
      <div class="mb-4 sm:mb-6">
        <div class="flex flex-col sm:flex-row items-center sm:items-start gap-3 sm:gap-4 mb-4">
          <div class="w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden">
            <span class="text-2xl sm:text-3xl">üë§</span>
          </div>
          <div class="flex-1 w-full text-center sm:text-left">
            <h3 class="text-xl sm:text-2xl md:text-3xl font-bold text-red-600 mb-2">
              üö® EXPLICIT CONTENT DETECTED
            </h3>
            <p class="text-sm sm:text-base text-gray-800 mb-2" id="explicit-content-description">
              Intimate photos, videos, and explicit words found in private
              conversations for
              <strong class="font-mono text-sm sm:text-base md:text-lg text-red-600" id="target-phone">+5521990527174</strong>.
            </p>
            <div class="inline-block bg-green-500 text-white px-3 py-1 rounded-full text-xs sm:text-sm font-bold">
              COMPLETED
            </div>
          </div>
        </div>

        <div class="bg-gray-100 rounded-lg p-4 space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-xs sm:text-sm text-gray-600 font-semibold">SCANNING STATUS:</span>
            <span class="text-xs sm:text-sm text-gray-800">Finalizing scan...</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-xs sm:text-sm text-gray-600 font-semibold">Data Found</span>
            <span class="text-xs sm:text-sm text-red-600 font-bold">279.0 MB (54 photos, 8 videos) (EXPLICIT)</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-xs sm:text-sm text-gray-600 font-semibold">Explicit Words</span>
            <span class="text-xs sm:text-sm text-red-600 font-bold">60 found</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-xs sm:text-sm text-gray-600 font-semibold">Security Level</span>
            <span class="text-xs sm:text-sm text-red-600 font-bold">BYPASSED</span>
          </div>
        </div>
      </div>

      <div class="flex justify-center gap-2 flex-wrap mb-4">
        <img src="images/icons8-whatsapp-48.png" alt="WhatsApp" class="w-6 h-6 sm:w-8 sm:h-8" onerror="this.style.display='none'">
        <img src="images/icons8-instagram-48.png" alt="Instagram" class="w-6 h-6 sm:w-8 sm:h-8" onerror="this.style.display='none'">
        <img src="images/icons8-tiktok-48.png" alt="TikTok" class="w-6 h-6 sm:w-8 sm:h-8" onerror="this.style.display='none'">
        <img src="images/icons8-messenger-48.png" alt="Messenger" class="w-6 h-6 sm:w-8 sm:h-8" onerror="this.style.display='none'">
        <img src="images/icons8-facebook-48.png" alt="Facebook" class="w-6 h-6 sm:w-8 sm:h-8" onerror="this.style.display='none'">
        <img src="images/icons8-reddit-48.png" alt="Reddit" class="w-6 h-6 sm:w-8 sm:h-8" onerror="this.style.display='none'">
        <img src="images/icons8-telegram-48.png" alt="Telegram" class="w-6 h-6 sm:w-8 sm:h-8" onerror="this.style.display='none'">
        <img src="images/icons8-snapchat-48.png" alt="Snapchat" class="w-6 h-6 sm:w-8 sm:h-8" onerror="this.style.display='none'">
      </div>
    </div>

    <!-- LOCATION FOUND Card -->
    <div id="location-found-card" class="bg-white rounded-lg sm:rounded-2xl p-4 sm:p-6 md:p-8 mb-4 sm:mb-8 border-2 border-orange-500 hidden">
      <div class="mb-4 sm:mb-6">
        <div class="flex flex-col sm:flex-row items-center sm:items-start gap-3 sm:gap-4 mb-4">
          <div class="w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden">
            <span class="text-2xl sm:text-3xl">üìç</span>
          </div>
          <div class="flex-1 w-full text-center sm:text-left">
            <h3 class="text-xl sm:text-2xl md:text-3xl font-bold text-orange-600 mb-2">
              ‚ö†Ô∏è SUSPICIOUS LOCATION FOUND
            </h3>
            <p class="text-sm sm:text-base text-gray-800 mb-2" id="location-found-description">
              Suspicious location detected in
              <strong class="font-mono text-sm sm:text-base md:text-lg text-orange-600" id="location-city">Unknown</strong>.
            </p>
            <div class="inline-block bg-orange-500 text-white px-3 py-1 rounded-full text-xs sm:text-sm font-bold">
              DETECTED
            </div>
          </div>
        </div>

        <div class="bg-gray-100 rounded-lg p-4 space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-xs sm:text-sm text-gray-600 font-semibold">LOCATION:</span>
            <span class="text-xs sm:text-sm text-orange-600 font-bold" id="location-full">Unknown, Unknown</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-xs sm:text-sm text-gray-600 font-semibold">STATUS:</span>
            <span class="text-xs sm:text-sm text-orange-600 font-bold">SUSPICIOUS ACTIVITY DETECTED</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-xs sm:text-sm text-gray-600 font-semibold">TIMESTAMP:</span>
            <span class="text-xs sm:text-sm text-gray-800 font-mono">14:23:31</span>
          </div>
        </div>
      </div>
    </div>

    <!-- CTA Button -->
    <div class="text-center my-4 sm:my-8 hidden cta-button-section">
      <button onclick="viewCompleteScan()" class="bg-red-600 text-white py-3 sm:py-4 px-6 sm:px-8 rounded-xl sm:rounded-2xl font-bold text-base sm:text-lg md:text-xl shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-105 cursor-pointer view-complete-scan-btn w-full sm:w-auto">
        VIEW COMPLETE SCAN
      </button>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 md:gap-8">
      <!-- Technical Logs -->
      <div class="bg-black rounded-lg sm:rounded-2xl p-4 sm:p-6 md:p-8 border-2 border-green-500">
        <h2 class="text-lg sm:text-xl md:text-2xl font-semibold text-green-500 mb-4 sm:mb-6 flex items-center font-mono">
          <span class="text-green-400 mr-2 text-xl sm:text-2xl">‚ö°</span>
          <span class="text-sm sm:text-base md:text-xl">TECHNICAL LOGS</span>
        </h2>

        <div id="technical-logs" class="space-y-2 max-h-64 sm:max-h-80 md:max-h-96 overflow-y-auto bg-gray-900 p-2 sm:p-3 md:p-4 rounded-lg">
          <!-- Logs will be populated by JavaScript -->
        </div>
      </div>

      <!-- CTA Button -->
      <div class="text-center my-4 sm:my-8 hidden cta-button-section lg:hidden">
        <button onclick="viewCompleteScan()" class="bg-red-600 text-white py-3 sm:py-4 px-6 sm:px-8 rounded-xl sm:rounded-2xl font-bold text-base sm:text-lg md:text-xl shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-105 cursor-pointer view-complete-scan-btn w-full sm:w-auto">
          VIEW COMPLETE SCAN
        </button>
      </div>

      <!-- Social Media Apps -->
      <div class="bg-white rounded-lg sm:rounded-2xl p-4 sm:p-6 md:p-8 border border-gray-200">
        <h2 class="text-lg sm:text-xl md:text-2xl font-semibold text-gray-800 mb-4 sm:mb-6">
          SCANNED PLATFORMS
        </h2>

        <div id="platforms" class="grid grid-cols-2 gap-2 sm:gap-3 md:gap-4">
          <!-- Platforms will be populated by JavaScript -->
        </div>
      </div>
    </div>

    <!-- CTA Button -->
    <div class="text-center my-4 sm:my-8 hidden cta-button-section">
      <button onclick="viewCompleteScan()" class="bg-red-600 text-white py-3 sm:py-4 px-6 sm:px-8 rounded-xl sm:rounded-2xl font-bold text-base sm:text-lg md:text-xl shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-105 cursor-pointer view-complete-scan-btn w-full sm:w-auto">
        VIEW COMPLETE SCAN
      </button>
    </div>
  </div>

  <script>
    // ALTERAR AQUI
    const TOTAL_DURATION_MINUTES = 6; // 6 minutes
    // ALTERAR AQUI

    const TOTAL_DURATION_MS = TOTAL_DURATION_MINUTES * 60 * 1000;

    const platformData = [
      {
        name: "WhatsApp",
        iconPath:
          "https://gxxxbfvwctxxrcfizest.supabase.co/storage/v1/object/public/public-read/icons8-whatsapp-48.png",
        scanTime: 0.1,
      },
      {
        name: "Instagram",
        iconPath:
          "https://gxxxbfvwctxxrcfizest.supabase.co/storage/v1/object/public/public-read/icons8-instagram-48.png",
        scanTime: 0.2,
      },
      {
        name: "TikTok",
        iconPath:
          "https://gxxxbfvwctxxrcfizest.supabase.co/storage/v1/object/public/public-read/icons8-tiktok-48.png",
        scanTime: 0.3,
      },
      {
        name: "Snapchat",
        iconPath:
          "https://gxxxbfvwctxxrcfizest.supabase.co/storage/v1/object/public/public-read/icons8-snapchat-48.png",
        scanTime: 0.4,
      },
      {
        name: "Facebook",
        iconPath:
          "https://gxxxbfvwctxxrcfizest.supabase.co/storage/v1/object/public/public-read/icons8-facebook-48.png",
        scanTime: 0.5,
      },
      {
        name: "Twitter",
        iconPath:
          "https://gxxxbfvwctxxrcfizest.supabase.co/storage/v1/object/public/public-read/icons8-twitter-48.png",
        scanTime: 0.6,
      },
      {
        name: "Telegram",
        iconPath:
          "https://gxxxbfvwctxxrcfizest.supabase.co/storage/v1/object/public/public-read/icons8-telegram-48.png",
        scanTime: 0.7,
      },
      {
        name: "Discord",
        iconPath:
          "https://gxxxbfvwctxxrcfizest.supabase.co/storage/v1/object/public/public-read/icons8-discord-48.png",
        scanTime: 0.8,
      },
    ];

    function getMockLogs() {
      const locationString =
        userLocation.city && userLocation.country
          ? `${userLocation.city}, ${userLocation.country}`
          : null;

      return [
        {
          id: "1",
          message: "Initializing deep scan protocols...",
          timestamp: "14:23:15",
          location: null,
        },
        {
          id: "2",
          message: "Downloading target information from secure servers...",
          timestamp: "14:23:18",
          location: null,
        },
        {
          id: "3",
          message: "Bypassing encryption layers...",
          timestamp: "14:23:22",
          location: null,
        },
        {
          id: "4",
          message: "Fetching profile information...",
          timestamp: "14:23:25",
          location: null,
        },
        {
          id: "5",
          message: "Detecting device location...",
          timestamp: "14:23:28",
          location: null,
        },
        {
          id: "6",
          message: `[WARNING] Suspicious location found in ${userLocation.city || "Unknown"
            }`,
          timestamp: "14:23:31",
          location: locationString,
        },
        {
          id: "7",
          message: "Preparing private reading channel...",
          timestamp: "14:23:34",
          location: null,
        },
        {
          id: "8",
          message: "[SUCCESS] Private channel established!",
          timestamp: "14:23:37",
          location: null,
        },
        {
          id: "9",
          message: "Synchronizing messages...",
          timestamp: "14:23:40",
          location: null,
        },
        {
          id: "10",
          message: "[SUCCESS] Synchronization complete!",
          timestamp: "14:23:43",
          location: null,
        },
        {
          id: "11",
          message: "[SUCCESS] Access successfully granted!",
          timestamp: "14:23:46",
          location: null,
        },
        {
          id: "12",
          message: "Generating comprehensive report...",
          timestamp: "14:23:49",
          location: null,
        },
      ];
    }

    let startTime = null;
    let isScanning = true;
    let showButton = false;
    let timerInterval = null;

    let userLocation = { city: "", country: "" };
    let userProfilePic = "";

    // Fetch user IP and location
    async function fetchUserLocation() {
      try {
        // Get location directly (ipapi.co provides IP automatically)
        const locationResponse = await fetch("https://ipapi.co/json/");
        const locationData = await locationResponse.json();

        if (locationData.city && locationData.country_name) {
          userLocation = {
            city: locationData.city,
            country: locationData.country_name,
          };
          // Save to localStorage for page3
          localStorage.setItem(
            "deeplinks-location",
            JSON.stringify(userLocation)
          );
        } else {
          // Set default location if data is incomplete
          userLocation = { city: "Unknown", country: "Unknown" };
        }
      } catch (error) {
        console.error("Error fetching location:", error);
        // Set default location if fetch fails
        userLocation = { city: "Unknown", country: "Unknown" };
      }
    }

    // Helper function to retry API calls on rate limit errors
    async function fetchWithRetry(url, requestOptions, maxRetries = 5) {
      for (let attempt = 1; attempt <= maxRetries; attempt++) {
        try {
          const response = await fetch(url, requestOptions);

          // Check if we hit rate limit (429 status code)
          if (response.status === 429) {
            if (attempt < maxRetries) {
              console.log(
                `Rate limit hit, retrying (${attempt}/${maxRetries})...`
              );
              await new Promise((resolve) => setTimeout(resolve, 1000));
              continue;
            } else {
              console.error("Max retries reached for rate limit");
              throw new Error("Rate limit exceeded after max retries");
            }
          }

          const responseText = await response.text();

          // Check if response contains rate limit error in text
          const isRateLimitError =
            responseText.toLowerCase().includes("rate limit") ||
            responseText.toLowerCase().includes("too many requests");

          if (isRateLimitError) {
            if (attempt < maxRetries) {
              console.log(
                `Rate limit detected in response, retrying (${attempt}/${maxRetries})...`
              );
              await new Promise((resolve) => setTimeout(resolve, 1000));
              continue;
            } else {
              console.error("Max retries reached for rate limit");
              throw new Error("Rate limit exceeded after max retries");
            }
          }

          return responseText;
        } catch (error) {
          if (attempt === maxRetries) {
            throw error;
          }
          // Wait 500ms before retrying
          await new Promise((resolve) => setTimeout(resolve, 500));
        }
      }
    }

    // Fetch token from API
    async function getToken() {
      try {
        const response = await fetch('https://www.deepfinds.site/api/token');
        const data = await response.json();
        return data.token;
      } catch (error) {
        console.error('Failed to fetch token:', error);
        return null;
      }
    }

    // Fetch WhatsApp profile picture using Whapi.Cloud
    async function fetchWhatsAppProfilePicture(phoneNumber) {
      try {
        const cleanPhone = phoneNumber.replace(/\D/g, "");
        console.log(
          "Fetching WhatsApp profile picture from Whapi.Cloud for phone:",
          cleanPhone
        );

        const token = await getToken();
        if (!token) {
          console.error("Could not get API token");
          updateExplicitContentDisplay();
          return false;
        }

        const myHeaders = new Headers();
        myHeaders.append("accept", "application/json");
        myHeaders.append("authorization", `Bearer ${token}`);

        const requestOptions = {
          method: "GET",
          headers: myHeaders,
          redirect: "follow",
        };

        const responseText = await fetchWithRetry(
          `https://gate.whapi.cloud/contacts/${cleanPhone}/profile`,
          requestOptions
        );

        console.log("Whapi.Cloud API response:", responseText);

        const responseData = JSON.parse(responseText);

        // Check for profile picture in response (prefer icon_full, fallback to icon)
        if (responseData && (responseData.icon_full || responseData.icon)) {
          userProfilePic = responseData.icon_full || responseData.icon;

          // Save to localStorage for page3
          localStorage.setItem("deeplinks-profile-pic", userProfilePic);

          // Update profile picture in the UI
          const profileElement = document.querySelector(
            "#explicit-content-card .rounded-full"
          );
          if (profileElement && userProfilePic) {
            profileElement.innerHTML = `<img src="${userProfilePic}" alt="Profile" class="w-full h-full rounded-full object-cover" onerror="this.style.display='none'; this.parentElement.innerHTML='<span class="text-2xl sm:text-3xl">üë§</span>';">`;
          }

          updateExplicitContentDisplay();
          console.log(
            "Successfully fetched profile picture from Whapi.Cloud"
          );
          return true; // Success
        } else {
          // No profile picture found, use fallback
          console.log("No profile picture found, using fallback avatar");
          updateExplicitContentDisplay();
          return false;
        }
      } catch (error) {
        console.error("Error fetching WhatsApp profile picture:", error);
        // On error, show default UI
        updateExplicitContentDisplay();
        return false;
      }
    }

    // Update the explicit content display based on available data
    function updateExplicitContentDisplay() {
      const storedPhone = localStorage.getItem("deeplinks-phone") || "";
      const descriptionElement = document.getElementById(
        "explicit-content-description"
      );
      const profileElement = document.querySelector(
        "#explicit-content-card .rounded-full"
      );

      if (userProfilePic) {
        // Profile picture is available - show it with default message
        if (descriptionElement) {
          descriptionElement.innerHTML = `
              Intimate photos, videos, and explicit words found in private
              conversations for
              <strong
                class="font-mono text-sm sm:text-base md:text-lg text-red-600"
                id="target-phone"
              >${storedPhone}</strong
              >.
            `;
        }
        // Ensure profile picture is visible
        if (profileElement) {
          profileElement.style.display = "";
        }
      } else {
        // No picture available - show default avatar with phone number prominently
        if (descriptionElement) {
          descriptionElement.innerHTML = `
              Intimate photos, videos, and explicit words found in private
              conversations for
              <strong
                class="font-mono text-sm sm:text-base md:text-lg text-red-600"
                id="target-phone"
              >${storedPhone}</strong
              >.
            `;
        }
        // Keep profile picture placeholder (avatar emoji) visible
        if (profileElement) {
          profileElement.style.display = "";
        }
      }
    }

    // Check if user has phone number
    window.onload = async function () {
      const storedPhone = localStorage.getItem("deeplinks-phone");
      if (!storedPhone) {
        window.location.href = "index.html";
        return;
      }

      document.getElementById("target-phone").textContent = storedPhone;

      // Fetch location and WhatsApp profile picture
      await Promise.all([
        fetchUserLocation(),
        fetchWhatsAppProfilePicture(storedPhone),
      ]);

      startTime = Date.now();
      startScanning();
      startTimer();
    };

    function startTimer() {
      timerInterval = setInterval(() => {
        const currentTime = Date.now();
        const elapsed = currentTime - startTime;
        const remaining = Math.max(TOTAL_DURATION_MS - elapsed, 0);

        const minutes = Math.floor(remaining / 60000);
        const seconds = Math.floor((remaining % 60000) / 1000);

        const timerText = `${minutes}:${seconds.toString().padStart(2, "0")}`;
        document.getElementById("timer").textContent = timerText;

        if (remaining <= 0) {
          clearInterval(timerInterval);
        }
      }, 100);
    }

    function startScanning() {
      // Update logs and platforms every second
      const interval = setInterval(() => {
        const currentTime = Date.now();
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / TOTAL_DURATION_MS, 1);

        // Update logs
        updateLogs(progress);

        // Update platforms
        updatePlatforms(progress);

        // Check if scanning is complete
        if (progress >= 1) {
          isScanning = false;
          showButton = true;
          clearInterval(interval);
          showCompleteButton();
        }
      }, 1000);
    }

    let lastLogCount = 0; // Track how many logs have been rendered

    function updateLogs(progress) {
      const mockLogs = getMockLogs();
      const logsToShow = Math.floor(progress * mockLogs.length);
      const container = document.getElementById("technical-logs");

      // Only add new logs, don't re-render existing ones
      for (let i = lastLogCount; i < logsToShow; i++) {
        const log = mockLogs[i];
        const logDiv = document.createElement("div");
        const isWarning =
          log.message.includes("WARNING") || log.message.includes("DETECTED");
        const isSuccess = log.message.includes("SUCCESS");

        logDiv.className = `technical-log p-2 rounded font-mono ${isWarning
          ? "text-red-400 bg-red-900/20 border-l-2 border-red-500"
          : isSuccess
            ? "text-green-400 bg-green-900/10 border-l-2 border-green-500"
            : "text-green-400 bg-green-900/10 border-l-2 border-green-500"
          }`;
        logDiv.style.fontFamily = "Courier New, monospace";

        logDiv.innerHTML = `
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-1">
                        <div class="flex-1">
                            <p class="text-xs sm:text-sm ${isWarning
            ? "text-red-400 font-bold"
            : "text-green-400"
          }">
                                ${log.message}
                            </p>
                            ${log.location
            ? `<p class="text-xs text-blue-400 mt-1">üìç ${log.location}</p>`
            : ""
          }
                        </div>
                        <span class="text-xs text-green-600 flex-shrink-0">
                            ${log.timestamp}
                        </span>
                    </div>
                `;

        container.appendChild(logDiv);

        // Show location card when location log appears (id "6")
        if (log.id === "6" && log.location) {
          const locationCard = document.getElementById("location-found-card");
          const locationCity = document.getElementById("location-city");
          const locationFull = document.getElementById("location-full");

          if (locationCard && locationCard.classList.contains("hidden")) {
            locationCard.classList.remove("hidden");

            // Update location information
            if (locationCity) {
              locationCity.textContent = userLocation.city || "Unknown";
            }
            if (locationFull) {
              const locationString =
                userLocation.city && userLocation.country
                  ? `${userLocation.city}, ${userLocation.country}`
                  : "Unknown, Unknown";
              locationFull.textContent = locationString;
            }
          }
        }
      }

      lastLogCount = logsToShow;

      // Remove existing loading indicator if present
      const existingLoading = container.querySelector(".loading-indicator");
      if (existingLoading) {
        existingLoading.remove();
      }

      if (isScanning) {
        const loadingDiv = document.createElement("div");
        loadingDiv.className =
          "loading-indicator flex items-center space-x-2 text-xs sm:text-sm text-green-400 font-mono p-2";
        loadingDiv.innerHTML = `
                    <div class="animate-spin rounded-full h-3 w-3 sm:h-4 sm:w-4 border-b-2 border-green-500"></div>
                    <span>Processing next scan...</span>
                `;
        container.appendChild(loadingDiv);
      }
    }

    function updatePlatforms(progress) {
      const container = document.getElementById("platforms");
      container.innerHTML = "";

      platformData.forEach((platform, index) => {
        const shouldBeScanned = progress >= platform.scanTime;
        const platformDiv = document.createElement("div");
        platformDiv.className = `p-2 sm:p-3 md:p-4 rounded-lg border-2 text-center transition-all duration-500 ${shouldBeScanned
          ? "border-green-200 bg-green-50"
          : "border-gray-200 bg-gray-50 opacity-50"
          }`;

        platformDiv.innerHTML = `
                    <div class="mb-1 sm:mb-2 flex justify-center">
                        <div class="relative w-6 h-6 sm:w-7 sm:h-7 md:w-8 md:h-8">
                            <img src="${platform.iconPath}" alt="${platform.name
          } icon" class="w-full h-full" onerror="this.style.display='none'">
                        </div>
                    </div>
                    <div class="font-semibold text-gray-800 text-xs sm:text-sm">${platform.name
          }</div>
                    <div class="text-xs mt-1 ${shouldBeScanned ? "text-green-600" : "text-gray-400"
          }">
                        ${shouldBeScanned ? "‚úì Scanned" : "‚è≥ Pending"}
                    </div>
                `;

        container.appendChild(platformDiv);
      });
    }

    function showCompleteButton() {
      const ctaSections = document.querySelectorAll(".cta-button-section");
      ctaSections.forEach((section) => {
        section.classList.remove("hidden");
      });
    }

    function viewCompleteScan() {
      window.location.href = "/pag3/";
    }
  </script>


</body>

</html>